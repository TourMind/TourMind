<main class="container mx-auto flex">
  <div class="flex flex-col mt-20 mx-auto">
    <div>
      <%= link_to "所有行程", plans_path, class: "text-blue-600"%>
      <% if user_signed_in? %>
        <% if current_user == @plan.user %>
          <%= link_to "編輯行程", edit_plan_path(@plan), class: "text-blue-600"%>
          <%= link_to "刪除行程", plan_path(@plan.id), method: "delete", class: "text-blue-600"%>
        <% else %>
          <%= link_to "修改並儲存為自己的行程！", edit_plan_path(@plan), class: "text-pink-500"%>
        <% end %>
      <% end %>
    </div>
    <section class="flex w-full h-96 mt-3 gap-2 relative">
      <button class="flex justify-center opacity-80 group absolute right-3 bottom-3 h-7 w-28 overflow-hidden rounded-full bg-slate-800 text-lg shadow">
        <div class="absolute inset-0 w-0 bg-white transition-all duration-[250ms] ease-out group-hover:w-full"></div>
        <span class="relative text-white group-hover:text-black text-sm self-center">查看所有照片</span>
      </button>
      <div class="h-full w-2/3 overflow-hidden">
        <img src="<%=@plan.images[0].present? ? @plan.images[0] : "https://fakeimg.pl/350x200/?text=TourMind"%>" class="object-fit w-full h-full">
      </div>
      <div class="h-full w-1/3 flex flex-col gap-2">
        <div class="h-1/2 w-full overflow-hidden">
          <img src="<%=@plan.images[1].present? ? @plan.images[1] : "https://fakeimg.pl/350x200/?text=TourMind"%>"  class="object-fit w-full h-full">
        </div>
        <div class="h-1/2 w-full  overflow-hidden">
          <img src="<%=@plan.images[2].present? ? @plan.images[2] : "https://fakeimg.pl/350x200/?text=TourMind"%>"  class="object-fit w-full h-full">
        </div>
      </div>
    </section>
    <section class="mx-3">
      <div class=" w-2/3">
        <h1 class="mt-8 text-3xl font-medium"><%= @plan.name %></h1>
        <p class="mt-2 text-sm underline text-slate-700"><a href="">提供者： <%= @plan.user.name || @plan.user.email %> </a></p>
        <div class="flex items-center my-3">
          <span><%= star_rating(@plan_data[@plan.id][:average_rating]) %>
                <%= sprintf('%.1f', @plan_data[@plan.id][:average_rating]) %>
                (<%= @plan_data[@plan.id][:comment_count] %>則評論)
          </span>
        </div>
        <p class="my-3 w-3/4 text-slate-700 text-m"><%= @plan.description %></p>
        <div class="border-y-2 border-slate-300 w-full">
          <p class="my-3 text-slate-700 text-m">適合人數： <%= @plan.people || 1 %> 人</p>
          <p class="my-3 text-slate-700 text-m">所需時間： <%= @plan.days %> 天</p>
          <p class="my-3 text-slate-700 text-m">分類： <%= @plan.category %></p>
          <% if user_signed_in? && current_user == @plan.user %>
            <p class="my-3 text-blue-600 text-m">行程公開狀態： <%= @plan.public ? "所有人皆可查看" : "私人行程" %></p>
          <% end %>
        </div>
      </div>
    </section>
    <%= render "plan_overview"%>
  </div>
</main>
<section class='w-full container mx-auto'>
  <div data-controller="butt">
    <a data-action="click->butt#toggleCommentForm" class="mt-2 rounded-lg py-3 px-5 bg-gray-100 inline-block font-medium" href="#comment-form">
      發表評論
    </a>
    <div class="hidden" data-butt-target="form" >
      <%= render "comments/comment", comment: Comment.new, plan:@plan %>
      <div class="min-w-full my-5 px-4">
        <div class="overflow-y-auto h-60 ">
          <div id="comment-list">
          <% @plan.comments.each do |comment| %>
            <%= render partial: 'comment', locals: { comment: comment } %>
          <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
  