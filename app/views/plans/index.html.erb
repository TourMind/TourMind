<main class="mt-10 container mx-auto">
  <% if user_signed_in? %>
    <section class="">
      <div class="border-b-2  border-slate-300 mb-12 pb-12">
        <%= link_to "新增我的專屬行程！", new_plan_path, class: "text-pink-500 inline-block mb-5" %>
        <h1 class="text-xl font-bold">我的行程</h1>
        <div class="overflow-x-scroll">
          <div class="flex gap-5 w-max py-5">
            <% if current_user.plans.any? %>
              <% current_user.plans.order(id: :desc).each do |plan| %>
                <div class="w-48 overflow-hidden rounded-xl bg-white shadow-md duration-200 hover:scale-105 hover:shadow-xl">
                  <%= link_to plan_path(plan.id), class: "inline-block" do %>
                    <img src="<%= plan.images.present? ? plan.images[0].url : "https://fakeimg.pl/350x200/?text=TourMind" %>" alt="plant" class="h-auto w-full" />
                    <div class="p-5 flex flex-col gap-5 h-auto">
                      <div class="font-bold"><%= plan.name %></div>
                      <div>
                        <div class="flex items-center my-3">
                         <span><%= star_rating(@plan_data[plan.id][:average_rating]) %></span>
                         <span>(<%= @plan_data[plan.id][:comment_count] %>)</span>
                        </div>
                        <div class="text-xs text-slate-500 mb-5">為期<%= plan.days %>天的行程 </div>
                        <div>
                          <button class="w-fit inline-block rounded-md bg-indigo-600 text-indigo-100 hover:bg-indigo-500 hover:shadow-md duration-75 px-3 pb-1"><span class="text-xs">詳細資訊</span></button>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% end %>
            <% else %>
              <h1>你還沒有屬於自己的行程規劃唷！</h1>
            <% end %>
          </div>
        </div>
      </div>
    </section>
  <% end %>
  <% Plan.category_options.each do |category| %>
    <% next if @plans.select {|plan| plan.category == category } == [] %>
    <section class="">
      <div class="border-b-2 border-slate-300 mb-12 pb-12">
        <h1 class="text-xl font-bold"><%= category %>之旅</h1>
        <div class="overflow-x-scroll">
          <div class="flex gap-5 w-max py-5">
            <% @plans.select {|plan| plan.category == category }.each do |plan| %>
              <div class="w-48 overflow-hidden rounded-xl bg-white shadow-md duration-200 hover:scale-105 hover:shadow-xl">
                <%= link_to plan_path(plan.id), class: "inline-block" do %>
                  <% if plan.images.present? %>
                    <img src="<%= plan.images[0].url %>" alt="plant" class="h-auto w-full" />
                  <% else %>
                    <%= image_tag "https://fakeimg.pl/350x200/?text=TourMind" , class:'h-auto w-full' %>
                  <% end %>
                  <div class="p-5 flex flex-col gap-5 h-auto">
                    <div class="font-bold"><%= plan.name %></div>
                    <div>
                      <div class="flex items-center my-3">
                        <span class=""><%= star_rating(@plan_data[plan.id][:average_rating]) %></span>
                        <span class="">(<%= @plan_data[plan.id][:comment_count] %>)</span>
                      </div>
                      <div class="text-xs text-slate-500 mb-5">為期<%= plan.days %>天的行程 </div>
                      <div>
                        <button class="w-fit inline-block rounded-md bg-indigo-600 text-indigo-100 hover:bg-indigo-500 hover:shadow-md duration-75 px-3 pb-1"><span class="text-xs">詳細資訊</span></button>
                      </div>
                    </div>
                  </div>
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </section>
<% end %>
</main>
